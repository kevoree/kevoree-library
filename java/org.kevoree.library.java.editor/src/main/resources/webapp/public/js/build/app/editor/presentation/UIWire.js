define(["util/Pooffs","abstraction/KInputPort","abstraction/KOutputPort","presentation/UIEntity","presentation/property/UIWireProps"],function(e,t,n,r,i){function a(e,a){function h(e){var t=f(c),n=e.getContext();n.beginPath(),n.moveTo(t.origin.x,t.origin.y),n.quadraticCurveTo(t.middle.x,t.middle.y,t.target.x,t.target.y),e.fillStroke(this),e.fill(this),e.stroke(this),n.closePath()}r.prototype.constructor.call(this,e),this._origin=e.getOrigin().getUI(),this._target=null;var l=function(){switch(e.getOrigin().getEntityType()){case n.ENTITY_TYPE:return o;case t.ENTITY_TYPE:return u;default:return s}}(),c=this;this._shape=new Kinetic.Shape({stroke:l,strokeWidth:5,lineCap:"round",lineJoin:"round",opacity:.6,drawFunc:function(e){h.call(this,e)},drawHitFunc:function(e){c._handlersEnabled&&h.call(this,e)}}),a.add(this._shape),this._shape.on("mouseenter",function(){this.setStrokeWidth(8),this.getLayer().draw()}),this._shape.on("mouseout",function(){this.setStrokeWidth(5),this.getLayer().draw()});var p=new i(e);this._shape.on("dblclick dbltap",function(e){e.cancelBubble=!0,p.show()})}function f(e){var t=e._origin?e._origin.getPosition():{x:0,y:0},n=e._target?e._target.getPosition(t):{x:0,y:0};return{origin:t,target:n,middle:e._computeMiddlePoint(t,n)}}e.extends(a,r);var s="#5aa564",o="#C60808",u="#ECCA40";return a.prototype.setOrigin=function(e){this._origin=e},a.prototype.setTarget=function(e){this._target=e,this._handlersEnabled=!0},a.prototype.draw=function(){this._shape.draw()},a.prototype._computeMiddlePoint=function(e,t){var n,r;return e.x>t.x?n=t.x+(e.x-t.x)/2:n=e.x+(t.x-e.x)/2,r=(e.y>=t.y?e.y:t.y)+30,{x:n,y:r}},a.prototype.remove=function(){if(this._shape){var e=this._shape.getLayer();this._shape.destroy(),e.draw()}},a.prototype.setTargetPoint=function(e){this._target={getPosition:function(){return e}}},a.prototype.setColor=function(e){this._shape.setAttrs({stroke:e})},a});