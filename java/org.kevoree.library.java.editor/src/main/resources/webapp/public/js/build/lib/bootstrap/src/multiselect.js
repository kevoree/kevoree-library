/**
         * bootstrap-multiselect.js 1.0.0
         * https://github.com/davidstutz/bootstrap-multiselect
         *
         * Copyright 2012 David Stutz
         *
         * Licensed under the Apache License, Version 2.0 (the "License");
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */

define(["jquery"],function(e){function t(t,n){this.options=this.getOptions(n),this.$select=e(t),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.options.multiple=this.$select.attr("multiple")=="multiple",this.$container=e(this.options.buttonContainer).append('<ul class="multiselect-container dropdown-menu'+(this.options.dropRight?" pull-right":"")+'" style="position:absolute; list-style-type: none;margin:0;padding:0;"></ul>').append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(this.getSelected(),this.$select)+"</button>"),this.options.buttonWidth&&e("button",this.$container).css({width:this.options.buttonWidth}),this.options.maxHeight&&(e(".multiselect-container",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),e('input[type="text"]',this.$container).width("75%")),this.options.enableFiltering&&(e(".multiselect-container",this.$container).prepend('<div class="input-prepend" style="padding:3px;"><span class="add-on"><i class="icon-search"></i></span><input class="multiselect-search" type="text" placeholder="'+this.options.filterPlaceholder+'"></div>'),e(".multiselect-search",this.$container).val(this.query).on("click",function(e){e.stopPropagation()}).on("keydown",e.proxy(function(t){clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(e.proxy(function(){this.query!=t.target.value&&(this.query=t.target.value,e.each(e(".multiselect-container li",this.$container),e.proxy(function(t,n){var r=e("input",n).val();if(r!=this.options.selectAllValue){var i=e("label",n).text(),r=e("input",n).val();if(r&&i&&r!=this.options.selectAllValue){var s=!1;(this.options.filterBehavior=="text"||this.options.filterBehavior=="both")&&i.indexOf(this.query)>-1&&(s=!0),(this.options.filterBehavior=="value"||this.options.filterBehavior=="both")&&r.indexOf(this.query)>-1&&(s=!0),s?e(n).show():e(n).hide()}}},this)))},this),300,this)},this))),this.buildDropdown(),this.updateButtonText(),this.$select.hide().after(this.$container)}typeof ko!="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(e,t,n,r,i){},update:function(t,n,r,i,s){var o=e(t).data("multiselect");o?r().options&&r().options().length!==o.originalOptions.length&&(o.updateOriginalOptions(),e(t).multiselect("rebuild")):e(t).multiselect(ko.utils.unwrapObservable(n()))}}),t.prototype={defaults:{buttonText:function(t,n){if(t.length==0)return'None selected <b class="caret"></b>';if(t.length>3)return t.length+' selected <b class="caret"></b>';var r="";return t.each(function(){var t=e(this).attr("label")!==undefined?e(this).attr("label"):e(this).text();r+=t+", "}),r.substr(0,r.length-2)+' <b class="caret"></b>'},onChange:function(e,t){},buttonClass:"btn",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,includeSelectAllOption:!1,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text"},constructor:t,createOptionValue:function(t){e(t).is(":selected")&&e(t).attr("selected","selected").prop("selected",!0);var n=e(t).attr("label")||e(t).text(),r=e(t).val(),i=this.options.multiple?"checkbox":"radio",s=e('<li><a href="javascript:void(0);" style="padding:0;"><label style="margin:0;padding:3px 20px 3px 20px;height:100%;cursor:pointer;"><input style="margin-bottom:5px;" type="'+i+'" /></label></a></li>'),o=e(t).prop("selected")||!1,u=e("input",s);u.val(r),r==this.options.selectAllValue&&u.parent().parent().addClass("multiselect-all"),e("label",s).append(" "+n),e(".multiselect-container",this.$container).append(s),e(t).is(":disabled")&&u.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"),u.prop("checked",o),o&&this.options.selectedClass&&u.parents("li").addClass(this.options.selectedClass)},toggleActiveState:function(t){this.$select.attr("disabled")==undefined?e("button.multiselect.dropdown-toggle",this.$container).removeClass("disabled"):e("button.multiselect.dropdown-toggle",this.$container).addClass("disabled")},buildDropdown:function(){var t=this.$select[0][0]?this.$select[0][0].value==this.options.selectAllValue:!1;this.options.includeSelectAllOption&&this.options.multiple&&!t&&this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>"),this.toggleActiveState(),this.$select.children().each(e.proxy(function(t,n){var r=e(n).prop("tagName").toLowerCase();if(r=="optgroup"){var i=n,s=e(i).prop("label"),o=e('<li><label style="margin:0;padding:3px 20px 3px 20px;height:100%;" class="multiselect-group"></label></li>');e("label",o).text(s),e(".multiselect-container",this.$container).append(o),e("option",i).each(e.proxy(function(e,t){this.createOptionValue(t)},this))}else r=="option"&&this.createOptionValue(n)},this)),e(".multiselect-container li input",this.$container).on("change",e.proxy(function(t){var n=e(t.target).prop("checked")||!1,r=e(t.target).val()==this.options.selectAllValue;this.options.selectedClass&&(n?e(t.target).parents("li").addClass(this.options.selectedClass):e(t.target).parents("li").removeClass(this.options.selectedClass));var i=e("option",this.$select).filter(function(){return e(this).val()==e(t.target).val()}),s=e("option",this.$select).not(i),o=e("input",this.$container).not(e(t.target));r&&o.filter(function(){return e(this).is(":checked")!=n}).trigger("click"),n?(i.prop("selected",!0),this.options.multiple?i.attr("selected","selected"):(this.options.selectedClass&&e(o).parents("li").removeClass(this.options.selectedClass),e(o).prop("checked",!1),s.removeAttr("selected").prop("selected",!1),e(this.$container).find(".multiselect.dropdown-toggle").click()),this.options.selectedClass=="active"&&s.parents("a").css("outline","")):i.removeAttr("selected").prop("selected",!1),this.updateButtonText(),this.options.onChange(i,n),this.$select.change()},this)),e(".multiselect-container li a",this.$container).on("touchstart click",function(e){e.stopPropagation()}),this.$container.on("keydown",e.proxy(function(t){if(e('input[type="text"]',this.$container).is(":focus"))return;if(t.keyCode!=9&&t.keyCode!=27||!this.$container.hasClass("open")){var n=e(this.$container).find("li:not(.divider):visible a");if(!n.length)return;var r=n.index(n.filter(":focus"));t.keyCode==38&&r>0?r--:t.keyCode==40&&r<n.length-1?r++:~r||(r=0);var i=n.eq(r);i.focus(),this.options.selectedClass=="active"&&(i.css("outline","thin dotted #333").css("outline","5px auto -webkit-focus-ring-color"),n.not(i).css("outline",""));if(t.keyCode==32||t.keyCode==13){var s=i.find("input");s.prop("checked",!s.prop("checked")),s.change()}t.stopPropagation(),t.preventDefault()}else e(this.$container).find(".multiselect.dropdown-toggle").click()},this))},destroy:function(){this.$container.remove(),this.$select.show()},refresh:function(){e("option",this.$select).each(e.proxy(function(t,n){var r=e(".multiselect-container li input",this.$container).filter(function(){return e(this).val()==e(n).val()});e(n).is(":selected")?(r.prop("checked",!0),this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass)):(r.prop("checked",!1),this.options.selectedClass&&r.parents("li").removeClass(this.options.selectedClass)),e(n).is(":disabled")?r.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):r.removeAttr("disabled").prop("disabled",!1).parents("li").removeClass("disabled")},this)),this.updateButtonText()},select:function(t){var n=e("option",this.$select).filter(function(){return e(this).val()==t}),r=e(".multiselect-container li input",this.$container).filter(function(){return e(this).val()==t});this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass),r.prop("checked",!0),n.attr("selected","selected").prop("selected",!0),this.updateButtonText()},deselect:function(t){var n=e("option",this.$select).filter(function(){return e(this).val()==t}),r=e(".multiselect-container li input",this.$container).filter(function(){return e(this).val()==t});this.options.selectedClass&&r.parents("li").removeClass(this.options.selectedClass),r.prop("checked",!1),n.removeAttr("selected").prop("selected",!1),this.updateButtonText()},rebuild:function(){e(".multiselect-container",this.$container).html(""),this.buildDropdown(this.$select,this.options),this.updateButtonText()},getOptions:function(t){return e.extend({},this.defaults,t)},updateButtonText:function(){var t=this.getSelected();e("button",this.$container).html(this.options.buttonText(t,this.$select))},getSelected:function(){return e('option:selected[value!="'+this.options.selectAllValue+'"]',this.$select)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(e,t,n){var r=Array.prototype.slice.call(arguments,3);return setTimeout(function(){e.apply(n||window,r)},t)}},e.fn.multiselect=function(n,r){return this.each(function(){var i=e(this).data("multiselect"),s=typeof n=="object"&&n;i||e(this).data("multiselect",i=new t(this,s)),typeof n=="string"&&i[n](r)})},e.fn.multiselect.Constructor=t,e(function(){e("select[data-role=multiselect]").multiselect()})});