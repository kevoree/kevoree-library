define(["util/Pooffs","abstraction/KEditor","abstraction/KGroup","abstraction/KComponent","abstraction/KChannel","abstraction/KNode","control/AController","presentation/UIEditor"],function(e,t,n,r,i,s,o,u){function a(e){t.prototype.constructor.call(this),this._ui=new u(this,e),this._currentWire=null,this._draggedEntity=null,this._libTreeDisplayed=!0,this._foldedLibTree=!1}return e.extends(a,t),e.extends(a,o),a.prototype.addEntity=function(e){t.prototype.addEntity.call(this,e),this._ui.c2pEntityAdded(e.getUI())},a.prototype.removeEntity=function(e){t.prototype.removeEntity.call(this,e),this._ui.c2pEntityRemoved(e.getUI())},a.prototype.p2cEntityDropped=function(e){if(this._draggedEntity&&this._draggedEntity.getEntityType()!=r.ENTITY_TYPE)this._draggedEntity.getUI().getShape().setPosition(e),this.addEntity(this._draggedEntity);else if(this._draggedEntity){var t=this._ui.getStage().getIntersection(e);t&&t.shape&&t.shape.parent&&t.shape.parent.nodeType=="Group"?t.shape.parent.fire("touchend"):this._ui.c2pDropImpossible(this._draggedEntity.getUI())}this._draggedEntity=null},a.prototype.setModelListener=function(e){if(!e||typeof e!=typeof {})throw"Editor setModelListener's callback should be an object";e.onUpdates&&typeof e.onUpdates=="function"&&(this._updateVisitor.setListener(e.onUpdates),this._removeVisitor.setListener(e.onUpdates))},a.prototype.p2cEntityDraggedOver=function(e,t){if(!this._draggedEntity){var o=require("factory/CFactory").getInstance();switch(e){case n.ENTITY_TYPE:this._draggedEntity=o.newGroup(this,t);break;case i.ENTITY_TYPE:this._draggedEntity=o.newChannel(this,t);break;case s.ENTITY_TYPE:this._draggedEntity=o.newNode(this,t);break;case r.ENTITY_TYPE:this._draggedEntity=o.newComponent(this,t);break;default:console.error("CEditor.p2cEntityDraggedOver(libItem, entity_type, name): I don't know this entity type: "+e);return}}},a.prototype.p2cEntityDraggedOut=function(){this._draggedEntity=null},a.prototype.update=function(e){this._ui.c2pEntityUpdated(e.getUI())},a.prototype.p2cMouseUp=function(e){this._currentWire&&this.abortWireCreationTask()},a.prototype.p2cDblTap=function(){this._ui.c2pZoomDefault()},a.prototype.p2cMouseMove=function(e){this._currentWire&&this._ui.c2pUpdateWire(this._currentWire.getUI(),e)},a.prototype.p2cZoomIn=function(){this._ui.c2pZoomIn()},a.prototype.p2cZoomTo=function(e){this._ui.c2pZoomTo(e)},a.prototype.p2cZoomDefault=function(){this._ui.c2pZoomDefault()},a.prototype.p2cZoomOut=function(){this._ui.c2pZoomOut()},a.prototype.p2cToggleLibTree=function(){this._libTreeDisplayed?this._ui.c2pHideLibTree():this._ui.c2pShowLibTree(),this._libTreeDisplayed=!this._libTreeDisplayed},a.prototype.p2cHideLibTree=function(){this._ui.c2pHideLibTree(),this._libTreeDisplayed=!this._libTreeDisplayed},a.prototype.p2cShowLibTree=function(){this._ui.c2pShowLibTree(),this._libTreeDisplayed=!this._libTreeDisplayed},a.prototype.p2cFoldAllLibTree=function(){this.getModel()&&(this._foldedLibTree?this._ui.c2pUnfoldAllLibTree():this._ui.c2pFoldAllLibTree(),this._foldedLibTree=!this._foldedLibTree)},a.prototype.setModel=function(e){t.prototype.setModel.call(this,e),this._ui.c2pModelUpdated()},a.prototype.getDraggedEntity=function(){return this._draggedEntity},a.prototype.setDraggedEntity=function(e){this._draggedEntity=e},a.prototype.getCurrentWire=function(){return this._currentWire},a.prototype.clear=function(){t.prototype.clear.call(this),this._ui.c2pClear()},a.prototype.clearInstances=function(){t.prototype.clearInstances.call(this)},a.prototype.startWireCreationTask=function(e){this._currentWire=e,this._ui.c2pWireAdded(e.getUI())},a.prototype.abortWireCreationTask=function(){this._currentWire.getOrigin().getUI().setDraggable(!0,!0,!0),this._currentWire.disconnect(),this._currentWire=null},a.prototype.endWireCreationTask=function(){this._currentWire=null},a.prototype.consumeDraggedEntity=function(){this._draggedEntity=null},a});