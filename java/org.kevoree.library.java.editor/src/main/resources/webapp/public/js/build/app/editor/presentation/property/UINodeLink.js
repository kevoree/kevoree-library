define(["jquery","templates/node-link-tab","templates/node-link-content"],function(e,t,n){function p(e){this._ctrl=e,this._jqy=[],this._selectedIDs=[],this._isActive=!1}function d(e){var t=[],n=e.getNetworkProperties();for(var r=0;r<n.length;r++)t.push({HTML:n[r].getUI().getHTML()});return t}var r=".node-link",i="node-link-type-",s="node-link-tab-val-",o="node-link-rate-",u="network-property-add-",a="network-property-delete-",f="network-property-list-",l=[i,s,o,u,a,f],c="network-property-row",h="data-net-prop-id";return p.prototype.getTabHTML=function(){var e={id:this._ctrl._id,type:this._ctrl.getNetworkType(),isActive:this._isActive,minRate:0,maxRate:100,rate:this._ctrl.getEstimatedRate(),props:d(this._ctrl)};return t(e)},p.prototype.setActive=function(t){this._isActive=t,t?(e("#node-link-root-"+this._ctrl._id).addClass("active"),e("#node-link-"+this._ctrl._id).addClass("active")):(e("#node-link-root-"+this._ctrl._id).removeClass("active"),e("#node-link-"+this._ctrl._id).removeClass("active"))},p.prototype.isActive=function(){return this._isActive},p.prototype.getContentHTML=function(){var e={id:this._ctrl._id,type:this._ctrl.getNetworkType(),isActive:this._isActive,minRate:0,maxRate:100,rate:this._ctrl.getEstimatedRate(),props:d(this._ctrl)};return n(e)},p.prototype.onHTMLAppended=function(){var t=this,n=this._ctrl._id;this._selectedIDs.length=0;for(var s=0;s<l.length;s++)this._jqy[l[s]]=e("#"+l[s]+n);this._jqy[f].selectable({filter:"."+c}),this._jqy[f].off("selectableselecting"+r),this._jqy[f].on("selectableselecting"+r,function(){t._jqy[a].removeClass("disabled")}),this._jqy[f].off("selectableunselecting"+r),this._jqy[f].on("selectableunselecting"+r,function(){var e=t._jqy[f].find(".ui-selected").size();e==0&&t._jqy[a].addClass("disabled")}),this._jqy[i].off(r),this._jqy[i].on("keyup"+r,function(){var n=e(this).val(),r=n.match(/\S+/g);r&&t._ctrl.p2cChangeType(r[0])}),this._jqy[o].off(r),this._jqy[o].on("change"+r,function(){t._ctrl.p2cChangeRate(e(this).val())}),this._jqy[u].off(r),this._jqy[u].on("click"+r,function(){t._ctrl.p2cAddNetworkProperty()}),this._jqy[a].off(r),this._jqy[a].on("click"+r,function(){var n=t._jqy[f].find(".ui-selected"),r=[];n.each(function(){r.push(parseInt(e(this).attr(h)))}),t._ctrl.p2cDeleteNetworkProperties(r)});var p=this._ctrl.getNetworkProperties();for(var s=0;s<p.length;s++)p[s].getUI().onHTMLAppended()},p.prototype.c2pSetNetworkType=function(e){this._jqy[s]&&this._jqy[s].text(e)},p.prototype.c2pAddNetworkProperty=function(e){this._jqy[f]&&(this._jqy[f].append(e.getUI().getHTML()),e.getUI().onHTMLAppended())},p.prototype.c2pDeleteNetworkProperty=function(e){this._jqy[f]&&this._jqy[f].find("["+h+"="+e._id+"]").remove()},p});