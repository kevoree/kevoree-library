define(["presentation/UIEntity","presentation/UIInputPort","util/Pooffs","require"],function(e,t,n,r){function s(t){e.prototype.constructor.call(this,t),i=r("presentation/UINode"),this._headerName=new Kinetic.Text({text:t.getName()+" : "+t.getType(),fontSize:14,fontFamily:"Helvetica",fill:"#FFF",padding:12,align:"center",drawFunc:function(e){n._drawHeader(),this.drawFunc(e)}});var n=this;this._rect=new Kinetic.Rect({width:n._headerName.getWidth(),height:n._headerName.getHeight(),fill:"white",opacity:.1,drawFunc:function(e){n._draw(),this.drawFunc(e)}}),this._border=new Kinetic.Rect({width:n._rect.getWidth(),height:n._rect.getHeight(),stroke:"white",strokeWidth:2,cornerRadius:10,shadowColor:"black",shadowBlur:10,shadowOffset:[5,5],shadowOpacity:.6,drawFunc:function(e){n._drawBorder(),this.drawFunc(e)}}),this._shape=new Kinetic.Group({draggable:!0}),this._shape.add(this._border),this._shape.add(this._rect),this._shape.add(this._headerName),this._mouseUpEvent=null,this._shape.on("mouseout touchend",function(){n._ctrl.p2cMouseOut()}),this._shape.on("dragmove",function(e){n._ctrl.p2cDragMove()})}var i=null;return n.extends(s,e),s.CHILD_X_PADDING=40,s.CHILD_Y_PADDING=15,s.prototype.ready=function(){if(!this._isReady){var e=this;this._shape.on("mouseup touchend",function(t){e._mouseUpEvent=t,e._ctrl.p2cMouseUp(this.getStage().getTouchPosition()||this.getStage().getPointerPosition())}),this._shape.on("dragstart",function(t){e._dragStartHandler(t)}),this._shape.on("dragend",function(t){e._ctrl.p2cDragEnd(),e._ctrl.getParent()&&(t.cancelBubble=!0)}),this._isReady=!0}},s.prototype._dragStartHandler=function(e){this._shape.setZIndex(0),this._ctrl.p2cDragStart(),this._ctrl.getParent()&&(e.cancelBubble=!0)},s.prototype.getChildOffset=function(e){var t=this._ctrl.getChildren(),n=this._headerName.getHeight();for(var r=0;r<t.length;r++){if(e===t[r].getUI())return{x:s.CHILD_X_PADDING/2,y:n};n+=t[r].getUI().getHeight()+s.CHILD_Y_PADDING}return{x:s.CHILD_X_PADDING/2,y:n}},s.prototype.c2pMouseOut=function(){document.body.style.cursor="default",this._border.setAttrs({strokeWidth:1,stroke:"white"}),this._shape.getLayer().draw()},s.prototype.c2pMouseOver=function(){document.body.style.cursor="pointer"},s.prototype.redrawParent=function(){this._shape&&this._shape.getParent()&&this._shape.getLayer()&&this._shape.getLayer().draw(),this._ctrl.getParent()&&this._ctrl.getParent().getUI().redrawParent()},s.prototype._drawHeader=function(){this._headerName.setText(this._ctrl.getName()+" : "+this._ctrl.getType())},s.prototype._draw=function(){},s.prototype._drawBorder=function(){this._border.setWidth(this._rect.getWidth()),this._border.setHeight(this._rect.getHeight())},s.prototype.getPosition=function(){var e=this._shape.getAbsolutePosition(),t=this._shape.getStage().getScale(),n=this._shape.getStage().getPosition();return{x:(e.x-n.x)/t.x,y:(e.y-n.y)/t.y}},s.prototype.getHeader=function(){return this._headerName},s.prototype.getWidth=function(){return this._rect.getWidth()},s.prototype.getHeight=function(){return this._rect.getHeight()},s.prototype.setWidth=function(e){this._rect.setWidth(e)},s.prototype.c2pRemoveDraggedEntity=function(){this._shape&&this._shape.remove()},s.prototype.setHeight=function(e){this._rect.setHeight(e)},s.prototype._noChildrenContainsPoint=function(e){var t=this._ctrl.getChildren();if(!this._ctrl.getParent()&&t.length>0)for(var n=0;n<t.length;n++)if(t[n].getUI().containsPoint(e))return!1;return!0},s.prototype.containsPoint=function(e){var t=this._rect.getAbsolutePosition();return t&&e&&t.x<=e.x&&e.x<=t.x+this.getHeader().getWidth()&&t.y<=e.y&&e.y<=t.y+this.getHeader().getHeight()},s});